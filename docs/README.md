# Учет заявок на ремонт климатического оборудования (Учебная практика)

Веб‑модуль для учета заявок на ремонт климатического оборудования (кондиционеры, увлажнители, сушилки и т.п.) с поддержкой ролей и базовой статистики.

## Запуск

```bash
cp .env.example .env
docker compose up --build
```

После старта приложения интерфейс доступен по адресу:  
`http://localhost:8000/ui/login`

## Вход

Тестовые логины/пароли берутся из `data/import/inputDataUsers.csv`:

- Менеджер: `login1 / pass1`
- Специалист: `login2 / pass2`
- Оператор: `login4 / pass4`
- Заказчик: `login7 / pass7`

## Роли и права

- **Менеджер**
  - видит все заявки;
  - создаёт/редактирует/удаляет заявки;
  - назначает исполнителей;
  - управляет пользователями (создание, редактирование, удаление, смена роли/пароля);
  - просматривает статистику.

- **Оператор**
  - видит все заявки;
  - создаёт/редактирует/удаляет заявки;
  - назначает исполнителей.

- **Специалист**
  - видит только свои заявки (`master_id = специалист`);
  - редактирует только свои заявки;
  - может менять статус своей заявки (кроме «раскрытия» финальной заявки обратно в нефинальную);
  - добавляет комментарии по своим заявкам.

- **Заказчик**
  - видит только свои заявки (`client_id = заказчик`);
  - создаёт новые заявки;
  - редактирует свои заявки только до наступления финального статуса;
  - не может сам менять статус, назначать исполнителя или менять комплектующие.

## Основные страницы

- `/ui/login` — вход
- `/ui/requests` — список заявок
- `/ui/requests/new` — новая заявка
- `/ui/requests/{id}` — карточка заявки
- `/ui/requests/{id}/edit` — редактирование заявки
- `/ui/statistics` — статистика (только Менеджер)
- `/ui/users` — список пользователей (только Менеджер)
- `/ui/users/new` — создание пользователя (Менеджер)
- `/ui/users/{id}/edit` — редактирование пользователя (Менеджер)

## Тестирование

Зависимости для тестов устанавливаются автоматически при сборке контейнера.

Запуск тестов локально (при установленном Python):

```bash
pip install -r scripts/requirements.txt
pytest -q
```

Покрыто:

- расчет статистики (среднее время ремонта, количество завершенных заявок);
- базовые правила RBAC (доступ к заявкам и смене статусов) — см. `tests/test_rbac.py`.

## Документы

- `docs/report1.md` — задание 1 (спецификация, алгоритмы, интерфейс, тесты)
- `docs/report2.md` — задание 2 (ERD/3НФ, импорт, отчеты, резервное копирование, доступ)
- `docs/er_diagram.mmd` — ER-диаграмма в формате Mermaid
- `db/reports.sql` — SQL‑отчеты (view’ы)
- `db/security.sql` — демонстрация ролей в PostgreSQL
- `docs/test_protocol.md` — протокол тестирования