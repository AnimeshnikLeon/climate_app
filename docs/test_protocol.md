# Протокол тестирования (Задание 1)

## 1. Объект тестирования

1. Функция расчета статистики: `services.calculate_statistics_from_rows`.
2. Ролевая логика доступа и смены статусов: `rbac.user_can_view_request`, `rbac.user_can_change_status`.

## 2. Инструмент

Pytest (автоматизированное модульное тестирование).

## 3. Входные данные

### 3.1. Тест T1 — статистика

Три заявки:

1. выполнена, start=2023-01-01, completion=2023-01-06 (5 дней)
2. выполнена, start=2023-01-10, completion=2023-01-11 (1 день)
3. не выполнена (не финальная)

### 3.2. Тест T2 — RBAC для статусов

Пользователи и статусы:

- Пользователь `u_spec` с ролью «Специалист».
- Пользователь `u_mgr` с ролью «Менеджер».
- Статус `s_final` — финальный.
- Статус `s_open` — не финальный.

## 4. Ожидаемый результат

### 4.1. Тест T1 — статистика

- `total_requests = 3`
- `completed_requests = 2`
- `average_repair_time_days = (5 + 1) / 2 = 3.0`

### 4.2. Тест T2 — RBAC

- Специалисту запрещено переводить заявку из финального статуса `s_final` в нефинальный `s_open`:
  - `user_can_change_status(u_spec, s_final, s_open) == False`.
- Менеджеру разрешены оба перехода:
  - `user_can_change_status(u_mgr, s_open, s_final) == True`;
  - `user_can_change_status(u_mgr, s_final, s_open) == True`.

## 5. Фактический результат

При запуске:

```bash
pytest -q
```

ожидается успешное выполнение всех тестов:

- тест статистики (`tests/test_statistics.py`) подтверждает корректный расчет среднего времени ремонта;
- тест ролевой логики (`tests/test_rbac.py`) подтверждает ограничения на смену статусов для специалиста и полномочия менеджера.